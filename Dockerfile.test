FROM networkml
LABEL maintainer="Charlie Lewis <clewis@iqt.org>"
COPY ./networkml ./networkml
COPY ./notebooks ./notebooks
COPY ./tests ./tests
ENV PATH="${PATH}:/root/.local/bin"
RUN apt-get update && apt-get install -y gcc rabbitmq-server && \
    rm -rf /var/cache && \
    poetry install -E test
RUN jupyter nbconvert --ExecutePreprocessor.timeout=300 --to notebook --execute notebooks/networkml_exploration.ipynb --Application.log_level=DEBUG
ENTRYPOINT ["pytest"]
CMD ["-l", "-s", "-v", "-nauto", "--cov=tests/", "--cov=networkml/", "--cov-report", "term-missing", "-c", ".coveragerc", "--rabbitmq-port=5672"]
